# San Diego Public Bathroom Audit (Open Map + Data Pipeline)

**Status:** üöß In progress (v0.x) ‚Äî migrating from an ArcGIS Online prototype to an open-source pipeline + public submission workflow.

An open-source, privacy-aware workflow to **collect, validate, and publish** a continuously improving geospatial dataset of **public bathroom access** across San Diego County.

This project has two outputs:
1) **Interactive map (user-facing):** view bathrooms + submit new locations + complete a short audit form
2) **Canonical dataset (engineering + policy):** versioned, analysis-ready outputs produced via repeatable ETL + QA

The map is the interface ‚Äî the **product is the validated dataset + documentation** that makes the data reliable for engineering and policy use.

---

## What exists today
- **AGOL prototype map** (current working version)
- Manual exports used as **seed data**
- Defined **data model + validation approach** (this repo)

## What‚Äôs being built next
- Automated **AGOL export ‚Üí raw ingest**
- Append-only **user submission intake**
- Validation + normalization + de-duplication
- Versioned canonical outputs (GeoJSON/CSV/Parquet)
- Open-source map UI that separates **verified** vs **unverified** layers

---

## Why this exists (policy + public health use)
Public bathroom availability is a critical access issue for:
- unhoused residents and outreach teams
- people with disabilities
- older adults, families, and commuters
- public health and sanitation efforts

Existing data is fragmented, inconsistent, or outdated. This project creates a **standardized, auditable dataset** suitable for:
- coverage gap analysis
- accessibility audits
- service planning and prioritization
- integration into GIS/public health workflows

---

## Data principles
- **Safety & privacy:** no personally identifying information is collected.
- **Auditability:** every record includes timestamps and provenance.
- **Validation-first:** submissions are *inputs* and must pass QA before entering canonical data.
- **Reproducibility:** outputs are generated by scripts, not manual edits.

---

## Data model (high level)

### 1) Submissions (raw / append-only)
User-submitted points and form responses stored as an append-only log.

Example fields:
- `submission_id`
- `submitted_at`
- `source` (web form, AGOL export, partner list)
- `lat`, `lon`
- `bathroom_name` (optional)
- audit attributes (below)

> Submissions may be shown on the map as **unverified** but do not enter canonical outputs until validated.

### 2) Canonical bathrooms (validated)
Curated ‚Äúbest current truth‚Äù dataset produced from validated submissions + trusted imports.

Example fields:
- `bathroom_id` (stable identifier)
- `geometry`
- `status` (active / unknown / closed)
- `last_verified_at`
- standardized audit attributes

### Audit attributes
- `open_to_public` (yes/no/unknown)
- `hours` (structured where possible)
- `accessible_ada` (yes/no/unknown)
- `requires_purchase` (yes/no/unknown)
- `restroom_type` (single, multi-stall, portable, other)
- `condition_score` (1‚Äì5)
- `has_handwashing` (yes/no/unknown)
- `safety_notes` (short, optional; no PII)

---

## Pipeline overview
1) **Ingest**
   - AGOL exports (seed dataset)
   - user submissions (append-only)
   - partner/city datasets (when available)

2) **Validate + normalize**
   - schema checks (required fields, datatypes)
   - geometry checks (valid coords; in-county bounds)
   - de-duplication / clustering (near-identical points)
   - standardization of categorical fields

3) **Publish**
   - `outputs/bathrooms_canonical.geojson`
   - `outputs/bathrooms_canonical.parquet`
   - `outputs/bathrooms_canonical.csv`
   - optional summary tables for policy reporting

---

## Suggested repo structure
bathrooms/
README.md
LICENSE
.gitignore
data/
raw/ # append-only exports + submissions (ignored or private)
interim/ # derived working files (ignored)
outputs/ # published, versioned artifacts (small, reviewable)
src/
ingest/
export_agol.py
ingest_submissions.py
validate/
schema.py
geometry_checks.py
dedupe.py
publish/
build_canonical.py
export_outputs.py
schema/
bathrooms_schema.yml
docs/
decisions.md
field_guide.md

---

## Roadmap
- [x] AGOL prototype map + audit fields
- [x] Draft schema + validation rules
- [ ] Automated AGOL export ‚Üí raw ingest
- [ ] Public submission form ‚Üí append-only log
- [ ] Validation + dedupe + stable `bathroom_id`
- [ ] Canonical dataset publish (GeoJSON/CSV/Parquet)
- [ ] Open-source map UI (verified vs unverified)
- [ ] Optional: PostGIS + FastAPI + Dockerized pipeline

---

## Notes (privacy)
Do not collect names, contact info, or any identifying details. Keep `safety_notes` short and non-identifying.
